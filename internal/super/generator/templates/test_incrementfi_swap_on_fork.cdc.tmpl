// The #test_fork pragma configures this test to run against a snapshot of mainnet state.
// This allows testing against real deployed contracts and production data.
#test_fork(network: "mainnet")

import Test
import "DeFiActions"

// Executes a minimal swap from FLOW -> stFlow using IncrementFi on a forked mainnet.
// Withdraws a tiny amount from a known FLOW holder and swaps via IncrementFi router.
access(all) fun testIncrementFi_SwapOnFork() {
	let HOLDER = Test.getAccount(0x42a06f24a1049154)
	let AMOUNT_IN: UFix64 = 0.001

	let txCode = Test.readFile("../transactions/incrementfi_swap_flow.cdc")

	let res = Test.executeTransaction(
		Test.Transaction(
			code: txCode,
			authorizers: [HOLDER.address],
			signers: [HOLDER],
			arguments: [AMOUNT_IN]
		)
	)

	Test.expect(res, Test.beSucceeded())

	// Log all swap events emitted during the transaction
	let swapEvents = Test.eventsOfType(Type<DeFiActions.Swapped>())
	log("Swap events:")
	for event in swapEvents {
		log(event)
	}
}


